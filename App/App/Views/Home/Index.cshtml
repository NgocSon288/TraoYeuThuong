@{
    ViewData["Title"] = "Home Page";
    Layout = null;
    var user = await _userManeger.GetUserAsync(User);

    var stories = ViewBag.stories as List<StoryHomeViewModel>;
    List<List<StoryHomeViewModel>> storiesCarousel = new List<List<StoryHomeViewModel>>();

    var countStories = stories?.Count ?? 0;
    var countCarosel = 0;

    // 4
    // 3  2 1

    while (countStories > 3)
    {
        var itemCarosel = new List<StoryHomeViewModel>();
        for (int i = countStories - 1; i >= countStories - 3; i--)
        {
            itemCarosel.Add(stories[i]);
        }

        storiesCarousel.Add(itemCarosel);

        countStories -= 3;
    }

    var itemCaroselT = new List<StoryHomeViewModel>();
    for (int i = countStories - 1; i >= 0; i--)
    {
        itemCaroselT.Add(stories[i]);
    }

    storiesCarousel.Add(itemCaroselT);

    countCarosel = storiesCarousel.Count;

}

<!DOCTYPE html>
<html lang="zxx">
<head>
    <title>Lois-Clark A Wedding Category Bootstrap Responsive WebSite Template| Home :: w3layouts</title>
    <!--meta tags -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="keywords" content="Lois-Clark Responsive web template, Bootstrap Web Templates, Flat Web Templates, Android Compatible web template,
      Smartphone Compatible web template, free webdesigns for Nokia, Samsung, LG, SonyEricsson, Motorola web design" />
    <script>
        addEventListener("load", function () {
            setTimeout(hideURLbar, 0);
        }, false);

        function hideURLbar() {
            window.scrollTo(0, 1);
        }
    </script>
    <!--//meta tags ends here-->
    <!--booststrap-->
    <link href="css/bootstrap.min.css" rel="stylesheet" type="text/css" media="all">
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <!--//booststrap end-->
    <!-- font-awesome icons -->
    <link href="css/fontawesome-all.min.css" rel="stylesheet" type="text/css" media="all">
    <!-- //font-awesome icons -->
    <link href="css/jquery-sakura.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="css/flexslider.css" type="text/css" media="screen" />
    <!--stylesheets-->
    <link href="css/style.css" rel='stylesheet' type='text/css' media="all">
    <!--//stylesheets-->
    <link href="//fonts.googleapis.com/css?family=Poiret+One" rel="stylesheet">
    <link href="//fonts.googleapis.com/css?family=Tangerine:400,700" rel="stylesheet">
    <link href="//fonts.googleapis.com/css?family=Raleway:400,500,600" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Sofia&effect=neon|outline|emboss|shadow-multiple">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Sofia&effect=fire">

</head>
<body>
    <div class="header-outs" id="header">
        <div class="header-w3layouts">
            <div class="container">
                <!--//navigation section -->
                <nav class="navbar navbar-expand-lg navbar-light">
                    <div class="hedder-up ">
                        <h1><a class="navbar-brand" href="index.html">A & B <span> Love</span></a></h1>
                    </div>
                    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <div class="collapse navbar-collapse justify-content-end" id="navbarSupportedContent">
                        <ul class="navbar-nav ">
                            <li class="nav-item active">
                                <a class="nav-link" href="/">Trang chủ <span class="sr-only">(current)</span></a>
                            </li>
                            @if (!_signInManager.IsSignedIn(User))
                            {
                                <li class="nav-item dropdown">
                                    <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        Tài khoản
                                    </a>
                                    <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                                        <a asp-controller="Login" asp-action="Index" class="nav-link">Đăng nhập</a>
                                        <a asp-controller="Login" asp-action="Register" class="nav-link">Đăng ký</a>
                                    </div>
                                </li>
                            }
                            else
                            {
                                <li class="nav-item dropdown">
                                    <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        @(user.FullName??"Bạn")
                                    </a>
                                    <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                                        <a asp-controller="Login" asp-action="Index" class="nav-link">Đăng xuất</a>
                                    </div>
                                </li>
                            }
                        </ul>
                    </div>
                </nav>
                <div class="clearfix"> </div>
            </div>
        </div>
        <!--//navigation section -->
        <div class="banner-slide-img text-center">
            <div class="banner-bride-name">
                <h4>Hãy</h4>
            </div>
            <div class="banner-groom-name">
                <h4>Trao Yêu Thương</h4>
            </div>
            <div class="banner-bride-name">
                <h4 style="font-size: 20px;">Đến những người thân yêu</h4>
            </div>
        </div>
        <div class="clearfix"> </div>
    </div>
    <!--banner -->
    <!--about-->
    <section class="about py-lg-4 py-md-3 py-sm-3 py-3">
        <div class="container py-lg-5 py-md-4 py-sm-4 py-3">
            <div class="row">
                <div class="col-lg-6 agile-left-side-img ">
                    <div class="mb-lg-5 mb-md-4 mb-3 jst-wthree-text">
                        <h2>Wedding Story</h2>
                    </div>
                    <p class="mb-lg-4 mb-3">Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore etLorem ipsum dolor sit amet, consectetur</p>
                    <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore etLorem ipsum dolor sit amet, consectetur etLorem ipsum dolor sit amet, consectetur</p>
                </div>
                <div class="offset-lg-2 col-lg-4 abut-img-grids">
                    <div class="wedding-graph">
                        <div class="bride-right-agile">
                            <img src="images/ab3.jpg" class="img-thumbnail" alt="">
                        </div>
                        <div class="wed-both">
                            <img src="images/ab1.jpg" class="img-thumbnail" alt="">
                        </div>
                        <div class="groom-left-agile">
                            <img src="images/ab2.jpg" class="img-thumbnail" alt="">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!--//about-->
    <!--Wedding-day -->
    <section class="date py-lg-4 py-md-3 py-sm-3 py-3">
        <div class="container py-lg-5 py-md-4 py-sm-4 py-3">
            <h3 class="title clr text-center mb-lg-5 mb-md-4 mb-sm-4 mb-3">Save The Date</h3>
            <div class="examples ">
                <div class="simply-countdown simply-countdown-one"></div>
            </div>
        </div>
    </section>
    <!--//Wedding-day -->
    <!--Wedding Journal-->

    @if (_signInManager.IsSignedIn(User))
    {


        <section class="wedding-journal py-lg-4 py-md-3 py-sm-3 py-3">
            <div class="container py-lg-5 py-md-4 py-sm-4 py-3">
                <h3 class="title text-center mb-lg-5 mb-md-4 mb-sm-4 mb-3">Love Story</h3>
                <a asp-controller="Story" asp-action="Create" class="d-inline-block mb-4 btn btn-outline-primary"> <i class="fas fa-plus"></i>  Tạo mới</a>
                @if (stories == null || stories.Count <= 0)
                {
                    <h4 class="font-effect-fire text-center">Hiện tại bạn chưa có Story nào</h4>
                }
                else
                {

                    <div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel">
                        <ol class="carousel-indicators">

                            @for (int i = 0; i < countCarosel; i++)
                            {
                                <li data-target="#carouselExampleIndicators" data-slide-to="@i" class="@(i==0?"active":"")"></li>
                            }
                        </ol>
                        <div class="carousel-inner">

                            @for (int i = 0; i < countCarosel; i++)
                            {
                                <div class="carousel-item @(i==0?"active":"")">
                                    <div class="row">
                                        @foreach (var item in storiesCarousel[i])
                                        {
                                            <div class="col-md-4 blog-grid-flex">
                                                <div class="clients-color">
                                                    <img src="Upload/@item.Avatar" class="img-thumbnail" alt="">
                                                    <div class="blog-txt-info">
                                                        <h4 class="mt-2"><a asp-controller="Story" asp-action="Index" asp-route-id="@item.Id">@item.Name</a></h4>
                                                        <div class="news-date my-3">
                                                            <ul>
                                                                <li><span class="far fa-calendar-check"></span><a href="javascript:void(0)">@item.CreatedDate.ToShortDateString()</a></li>
                                                            </ul>
                                                        </div>
                                                        <p>@item.Description</p>
                                                        <div class="d-flex justify-content-between">
                                                            <a asp-controller="Story" asp-action="Intro" asp-route-id="@item.Id" class="mr-4">Review</a>
                                                            <a asp-controller="Story" asp-action="Update" asp-route-id="@item.Id" class="mr-4">Edit</a>
                                                            <a asp-controller="Story" asp-action="Delete" asp-route-id="@item.Id" class="btn-delete-story text-danger">Delete</a>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        }
                                    </div>
                                </div>

                            }

                            <script>
                                $('.btn-delete-story').on('click', function (e) {
                                    e.preventDefault()
                                    if (confirm('Bạn có muốn xóa story này!')) {
                                        const href = $(this).attr('href')

                                        $.ajax({
                                            url: href,
                                            type: 'get',
                                            success: function (res) {
                                                if (res.isSuccess) {
                                                    window.location.reload()
                                                } else {
                                                    alert('Xóa không thành công!')
                                                }
                                            }
                                        })
                                    }
                                })
                            </script>

                        </div>
                        <!-- <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="sr-only">Previous</span>
                        </a>
                        <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="sr-only">Next</span>
                        </a>-->
                    </div>
                }
            </div>
        </section>

    }

    <!--//Wedding Journal-->
    <!-- footer -->
    <footer class="py-lg-4 py-md-3 py-sm-3 py-3">
        <div class="container py-lg-5 py-md-5 py-sm-4 py-3">
            <div class="groom-w3layouts-footer text-center">
                <img src="images/author-footer.jpg" alt="" class="image-fluid" width="100" height="100">
            </div>
            <div class="bride-groom-names text-center mt-lg-4 mt-3">
                <h4><a href="index.html">Huỳnh Ngọc Sơn</a></h4>
            </div>
            <div class="icons-footer text-center mt-lg-5 mt-md-4 mt-3">
                <ul>
                    <li><a href="#"><span class="fab fa-facebook-f"></span></a></li>
                    <li><a href="#"><span class="fas fa-envelope"></span></a></li>
                    <li><a href="#"><span class="fab fa-twitter"></span></a></li>
                    <li><a href="#"><span class="fab fa-pinterest-p"></span></a></li>
                </ul>
            </div>
            <div class="copy-agile-right text-center pt-lg-4 pt-3">
                <p>
                    © 2021 Huỳnh Ngọc Sơn
                </p>
            </div>
        </div>
    </footer>
    <!--//footer -->
    <!--js working-->
    <script src='js/jquery-2.2.3.min.js'></script>
    <!--//js working-->
    <script src="js/jquery-sakura.min.js"></script>
    <script>
        $(window).load(function () {
            $('body').sakura();
        });
    </script>
    <!-- flexisel image slider -->
    <script src="js/jquery.flexisel.js"></script>
    <script>
        $(window).load(function () {
            $("#flexiselDemo3").flexisel({
                visibleItems: 4,
                itemsToScroll: 1,
                autoPlay: {
                    enable: true,
                    interval: 5000,
                    pauseOnHover: true
                }
            });


        });
    </script>
    <!--// flexisel image slider -->
    <!--friends-honors FlexSlider -->
    <!-- FlexSlider -->
    <script defer src="js/jquery.flexslider.js"></script>
    <script>
        $(function () {
            SyntaxHighlighter.all();
        });
        $(window).load(function () {
            $('.flexslider').flexslider({
                animation: "slide",
                start: function (slider) {
                    $('body').removeClass('loading');
                }
            });
        });
    </script>
    <!-- //friends-honors FlexSlider -->
    <script src="js/simplyCountdown.js"></script>
    <script>
        var d = new Date();
        d.setDate(d.getDate() + 19);

        // default example
        simplyCountdown('.simply-countdown-one', {
            year: d.getFullYear(),
            month: d.getMonth() + 1,
            day: d.getDate()
        });
    </script>
    <!-- start-smoth-scrolling -->
    <script src="js/move-top.js"></script>
    <script src="js/easing.js"></script>
    <script>
        jQuery(document).ready(function ($) {
            $(".scroll").click(function (event) {
                event.preventDefault();
                $('html,body').animate({
                    scrollTop: $(this.hash).offset().top
                }, 900);
            });
        });
    </script>
    <!-- start-smoth-scrolling -->
    <!-- here stars scrolling icon -->
    <script>
        $(document).ready(function () {

            var defaults = {
                containerID: 'toTop', // fading element id
                containerHoverID: 'toTopHover', // fading element hover id
                scrollSpeed: 1200,
                easingType: 'linear'
            };


            $().UItoTop({
                easingType: 'easeOutQuart'
            });

        });
    </script>
    <!-- //here ends scrolling icon -->
    <!--bootstrap working-->
    <script src="js/bootstrap.min.js"></script>
    <!-- //bootstrap working-->
</body>
</html>